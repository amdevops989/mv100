<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Orders | Shop Demo</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { authHeader, getToken } from "./utils.js";

    async function fetchOrders() {
      const el = document.getElementById("ordersList");
      el.innerHTML = "";
      if (!getToken()) { el.innerText = "Login first"; return; }

      const res = await fetch("http://localhost:3003/orders", { headers: authHeader() });
      const orders = await res.json();
      if (!orders || orders.length === 0) {
        el.innerText = "No orders yet";
        return;
      }
      orders.forEach(o => {
        const div = document.createElement("div");
        div.className = "order";
        div.innerHTML = `
          <div>Order #${o.id} — $${o.amount} — ${o.status}</div>
          <button onclick="pay(${o.id}, ${o.amount})">Pay</button>
        `;
        el.appendChild(div);
      });
    }

    async function pay(orderId, amount) {
      await fetch("http://localhost:3004/payments", {
        method: "POST",
        headers: { "Content-Type": "application/json", ...authHeader() },
        body: JSON.stringify({ orderId, amount }),
      });
      alert("Payment sent!");
      fetchOrders();
    }

    window.pay = pay;
    fetchOrders();
  </script>
</head>
<body>
  <script src="header.js"></script>

  <main>
    <h1>Your Orders</h1>
    <div id="ordersList"></div>
  </main>
</body>
</html>
