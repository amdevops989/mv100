<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Products | Shop Demo</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { getToken, authHeader } from "./utils.js";

    async function fetchProducts() {
      const res = await fetch("http://localhost:3001/products");
      const products = await res.json();
      const list = document.getElementById("list");
      list.innerHTML = "";
      products.forEach(p => {
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <div><b>${p.name}</b> - $${p.price}</div>
          <button onclick="addToCart(${p.id})">Add to Cart</button>
        `;
        list.appendChild(div);
      });
    }

    async function addToCart(productId) {
      if (!getToken()) return alert("Login first");
      await fetch("http://localhost:3002/cart/add", {
        method: "POST",
        headers: { "Content-Type": "application/json", ...authHeader() },
        body: JSON.stringify({ productId, qty: 1 })
      });
      alert("Added to cart!");
    }

    window.addToCart = addToCart;
    fetchProducts();
  </script>
</head>
<body>
  <script src="header.js"></script>

  <main>
    <h1>Products</h1>
    <div id="list"></div>
  </main>
</body>
</html>
