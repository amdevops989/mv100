<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cart | Shop Demo</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { authHeader, getToken } from "./utils.js";

    async function fetchCart() {
      const el = document.getElementById("cartItems");
      el.innerHTML = "";
      if (!getToken()) { el.innerText = "Login first"; return; }
      const res = await fetch("http://localhost:3002/cart", { headers: authHeader() });
      const items = await res.json();
      if (!items || Object.keys(items).length === 0) {
        el.innerText = "Cart is empty";
        return;
      }
      for (const k in items) {
        const d = document.createElement("div");
        d.innerText = `Product ${k} â€” Qty: ${items[k]}`;
        el.appendChild(d);
      }
    }

    async function checkout() {
      const res = await fetch("http://localhost:3002/cart/checkout", {
        method: "POST", headers: authHeader()
      });
      alert("Checked out!");
      fetchCart();
    }

    window.checkout = checkout;
    fetchCart();
  </script>
</head>
<body>
  <script src="header.js"></script>

  <main>
    <h1>Your Cart</h1>
    <div id="cartItems"></div>
    <button onclick="checkout()">Checkout</button>
  </main>
</body>
</html>
